# serverless.yml

service: serverless-video-metadata-generator

provider:
  name: aws
  runtime: nodejs6.10

functions:
  extractMetadata:
    handler: handler.extractMetadata
    events:
      - s3: 
          bucket: your-uploads-bucket
          event: s3:ObjectCreated:*
  saveMetadata:
    handler: handler.saveMetadata
    events: 
      - sns: your-notification-sns-topic

resources:
  Resources:
    snsPublishRole:
      Type: AWS::IAM::Role
      Properties:
        RoleName: snsPublishRole
        AssumeRolePolicyDocument: 
          Version: '2017'
          Statement: 
            - 
              Effect: Allow
              Principal: 
                Service: 
                  - ec2.amazonaws.com
              Action: 
                - sts:AssumeRole
        Policies:
          - PolicyName:  snsPublishPolicy
            PolicyDocument: 
              Version: '2017'
              Statement: 
                - Effect: Allow
                  Action: 
                    - sns:Publish
                  Resource:
                    - 'Fn::Join':
                      - ':'
                      -
                        - arn:aws:sns
                        - Ref: AWS::Region
                        - Ref: AWS::AccountId
                        - your-notification-sns-topic